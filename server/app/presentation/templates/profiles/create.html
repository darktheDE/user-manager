{% extends "base.html" %}

{% block title %}Create Profile - User Manager{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Create New Profile</h1>
    <div class="page-actions">
        <a href="/profiles" class="btn btn-secondary">Back to Profiles</a>
    </div>
</div>

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Profile Information</h3>
    </div>
    <div class="card-body">
        <form method="post" action="/profiles/create">
            <div class="form-group">
                <label for="profile_name">Profile Name <span class="required">*</span></label>
                <input type="text" id="profile_name" name="profile_name" value="{{ profile_name or '' }}" required
                    pattern="[a-zA-Z][a-zA-Z0-9_]*"
                    title="Must start with a letter, only alphanumeric and underscore allowed"
                    placeholder="e.g., STAFF_PROFILE">
                <small class="form-hint">Must start with a letter, only alphanumeric and underscore allowed</small>
            </div>

            <div class="form-section">
                <h4 class="form-section-title">Resource Limits</h4>
                <p class="form-section-desc">Configure session and time limits for users with this profile</p>
            </div>

            <div class="form-group">
                <label for="sessions_per_user">SESSIONS_PER_USER</label>
                <div class="resource-input">
                    <select id="sessions_per_user_type" onchange="toggleResourceInput('sessions_per_user')">
                        <option value="DEFAULT" {% if not sessions_per_user or sessions_per_user=='DEFAULT' %}selected{%
                            endif %}>DEFAULT</option>
                        <option value="UNLIMITED" {% if sessions_per_user=='UNLIMITED' %}selected{% endif %}>UNLIMITED
                        </option>
                        <option value="CUSTOM" {% if sessions_per_user and sessions_per_user not in
                            ['DEFAULT', 'UNLIMITED' ] %}selected{% endif %}>Custom Value</option>
                    </select>
                    <input type="text" id="sessions_per_user_value" placeholder="Number of sessions"
                        style="{% if not sessions_per_user or sessions_per_user in ['DEFAULT', 'UNLIMITED'] %}display: none;{% endif %}"
                        value="{{ sessions_per_user if sessions_per_user and sessions_per_user not in ['DEFAULT', 'UNLIMITED'] else '' }}">
                    <input type="hidden" id="sessions_per_user" name="sessions_per_user"
                        value="{{ sessions_per_user or 'DEFAULT' }}">
                </div>
                <small class="form-hint">Maximum concurrent sessions per user</small>
            </div>

            <div class="form-group">
                <label for="connect_time">CONNECT_TIME (minutes)</label>
                <div class="resource-input">
                    <select id="connect_time_type" onchange="toggleResourceInput('connect_time')">
                        <option value="DEFAULT" {% if not connect_time or connect_time=='DEFAULT' %}selected{% endif %}>
                            DEFAULT</option>
                        <option value="UNLIMITED" {% if connect_time=='UNLIMITED' %}selected{% endif %}>UNLIMITED
                        </option>
                        <option value="CUSTOM" {% if connect_time and connect_time not in ['DEFAULT', 'UNLIMITED' ]
                            %}selected{% endif %}>Custom Value</option>
                    </select>
                    <input type="text" id="connect_time_value" placeholder="Minutes"
                        style="{% if not connect_time or connect_time in ['DEFAULT', 'UNLIMITED'] %}display: none;{% endif %}"
                        value="{{ connect_time if connect_time and connect_time not in ['DEFAULT', 'UNLIMITED'] else '' }}">
                    <input type="hidden" id="connect_time" name="connect_time" value="{{ connect_time or 'DEFAULT' }}">
                </div>
                <small class="form-hint">Maximum elapsed connection time</small>
            </div>

            <div class="form-group">
                <label for="idle_time">IDLE_TIME (minutes)</label>
                <div class="resource-input">
                    <select id="idle_time_type" onchange="toggleResourceInput('idle_time')">
                        <option value="DEFAULT" {% if not idle_time or idle_time=='DEFAULT' %}selected{% endif %}>
                            DEFAULT</option>
                        <option value="UNLIMITED" {% if idle_time=='UNLIMITED' %}selected{% endif %}>UNLIMITED</option>
                        <option value="CUSTOM" {% if idle_time and idle_time not in ['DEFAULT', 'UNLIMITED' ]
                            %}selected{% endif %}>Custom Value</option>
                    </select>
                    <input type="text" id="idle_time_value" placeholder="Minutes"
                        style="{% if not idle_time or idle_time in ['DEFAULT', 'UNLIMITED'] %}display: none;{% endif %}"
                        value="{{ idle_time if idle_time and idle_time not in ['DEFAULT', 'UNLIMITED'] else '' }}">
                    <input type="hidden" id="idle_time" name="idle_time" value="{{ idle_time or 'DEFAULT' }}">
                </div>
                <small class="form-hint">Maximum idle time before automatic disconnect</small>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Create Profile</button>
                <a href="/profiles" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        margin: 24px 0 16px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e0e0e0;
    }

    .form-section-title {
        margin: 0 0 4px;
        color: #333;
    }

    .form-section-desc {
        margin: 0;
        color: #666;
        font-size: 14px;
    }

    .resource-input {
        display: flex;
        gap: 8px;
    }

    .resource-input select {
        flex: 0 0 150px;
    }

    .resource-input input[type="text"] {
        flex: 1;
    }

    .required {
        color: #dc3545;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    function toggleResourceInput(fieldName) {
        const select = document.getElementById(fieldName + '_type');
        const input = document.getElementById(fieldName + '_value');
        const hidden = document.getElementById(fieldName);

        if (select.value === 'CUSTOM') {
            input.style.display = 'block';
            input.focus();
            hidden.value = input.value || 'DEFAULT';
        } else {
            input.style.display = 'none';
            hidden.value = select.value;
        }
    }

    // Update hidden field when custom value changes
    document.querySelectorAll('.resource-input input[type="text"]').forEach(input => {
        input.addEventListener('input', function () {
            const fieldName = this.id.replace('_value', '');
            const hidden = document.getElementById(fieldName);
            hidden.value = this.value || 'DEFAULT';
        });
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function () {
        ['sessions_per_user', 'connect_time', 'idle_time'].forEach(toggleResourceInput);
    });
</script>
{% endblock %}