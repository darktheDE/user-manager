<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}User Manager - Adminty{% endblock %}</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    {% block extra_css %}{% endblock %}
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            {% include "includes/sidebar.html" %}
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                {% include "includes/header.html" %}
            </header>

            <!-- Content Area -->
            <main class="content">
                {% block content %}{% endblock %}
            </main>

            <!-- Footer -->
            <footer class="footer">
                {% include "includes/footer.html" %}
            </footer>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        (function () {
            const sidebar = document.getElementById('sidebar');
            const SIDEBAR_STATE_KEY = 'sidebarState';
            const SIDEBAR_SCROLL_KEY = 'sidebarScroll';

            // Restore sidebar collapsed state
            const savedState = localStorage.getItem(SIDEBAR_STATE_KEY);
            if (savedState === 'collapsed') {
                sidebar.classList.add('collapsed');
                document.querySelector('.main-content')?.classList.add('sidebar-collapsed');
            }

            // Restore scroll position
            const savedScroll = localStorage.getItem(SIDEBAR_SCROLL_KEY);
            if (savedScroll && sidebar) {
                const sidebarNav = sidebar.querySelector('.sidebar-nav');
                if (sidebarNav) {
                    sidebarNav.scrollTop = parseInt(savedScroll, 10);
                }
            }

            // Toggle Sidebar (mobile)
            document.getElementById('mobileMenuToggle')?.addEventListener('click', function () {
                sidebar.classList.toggle('active');
            });

            // Toggle Sidebar collapse (desktop)
            document.getElementById('sidebarToggle')?.addEventListener('click', function () {
                sidebar.classList.toggle('collapsed');
                document.querySelector('.main-content')?.classList.toggle('sidebar-collapsed');

                // Save state
                const isCollapsed = sidebar.classList.contains('collapsed');
                localStorage.setItem(SIDEBAR_STATE_KEY, isCollapsed ? 'collapsed' : 'expanded');
            });

            // Save scroll position before unload
            window.addEventListener('beforeunload', function () {
                const sidebarNav = sidebar?.querySelector('.sidebar-nav');
                if (sidebarNav) {
                    localStorage.setItem(SIDEBAR_SCROLL_KEY, sidebarNav.scrollTop.toString());
                }
            });

            // Also save on scroll
            const sidebarNav = sidebar?.querySelector('.sidebar-nav');
            if (sidebarNav) {
                let scrollTimeout;
                sidebarNav.addEventListener('scroll', function () {
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(function () {
                        localStorage.setItem(SIDEBAR_SCROLL_KEY, sidebarNav.scrollTop.toString());
                    }, 100);
                });
            }
        })();
    </script>
    {% block extra_js %}{% endblock %}
</body>

</html>