{% extends "base.html" %}

{% block title %}VPD - Virtual Private Database{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üõ°Ô∏è VPD - Virtual Private Database</h1>
    <a href="/security" class="btn btn-secondary">‚Üê Quay l·∫°i</a>
</div>

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

<div class="info-card">
    <h3>C∆° ch·∫ø ho·∫°t ƒë·ªông</h3>
    <p>VPD t·ª± ƒë·ªông th√™m ƒëi·ªÅu ki·ªán WHERE v√†o m·ªçi query tr√™n b·∫£ng PROJECTS:</p>
    <pre><code>-- User thu·ªôc ph√≤ng IT login
SELECT * FROM PROJECTS;

-- VPD t·ª± ƒë·ªông th√™m:
SELECT * FROM PROJECTS WHERE DEPARTMENT = 'IT';</code></pre>
    <p><strong>K·∫øt qu·∫£:</strong> User ch·ªâ th·∫•y projects c·ªßa ph√≤ng m√¨nh.</p>
</div>

<div class="demo-section">
    <h3>üìã VPD Policies tr√™n PROJECTS</h3>
    {% if vpd_policies %}
    <table class="table">
        <thead>
            <tr>
                <th>Policy Name</th>
                <th>Function</th>
                <th>Enabled</th>
                <th>SELECT</th>
                <th>INSERT</th>
                <th>UPDATE</th>
                <th>DELETE</th>
            </tr>
        </thead>
        <tbody>
            {% for policy in vpd_policies %}
            <tr>
                <td><strong>{{ policy.policy_name }}</strong></td>
                <td><code>{{ policy.function }}</code></td>
                <td>
                    {% if policy.enable == 'YES' %}
                    <span class="badge badge-success">YES</span>
                    {% else %}
                    <span class="badge badge-secondary">NO</span>
                    {% endif %}
                </td>
                <td>{{ policy.sel }}</td>
                <td>{{ policy.ins }}</td>
                <td>{{ policy.upd }}</td>
                <td>{{ policy.del }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="alert alert-warning">
        Ch∆∞a c√≥ VPD policy. Ch·∫°y script <code>03_create_vpd_policy.sql</code>
    </div>
    {% endif %}
</div>

<div class="demo-section">
    <h3>üìÅ Projects b·∫°n c√≥ th·ªÉ th·∫•y (User: {{ username }})</h3>
    <p class="text-muted">
        N·∫øu VPD ƒëang active, b·∫°n ch·ªâ th·∫•y projects thu·ªôc department c·ªßa m√¨nh.
    </p>

    {% if projects %}
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Project Name</th>
                <th>Department</th>
                <th>Budget</th>
                <th>Status</th>
                <th>Owner</th>
            </tr>
        </thead>
        <tbody>
            {% for proj in projects %}
            <tr>
                <td>{{ proj.project_id }}</td>
                <td>{{ proj.project_name }}</td>
                <td><span class="badge badge-info">{{ proj.department }}</span></td>
                <td>
                    {% if proj.budget %}
                    ${{ "{:,.0f}".format(proj.budget) }}
                    {% else %}
                    <span class="text-muted">·∫®n</span>
                    {% endif %}
                </td>
                <td>{{ proj.status }}</td>
                <td>{{ proj.owner_username }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <p class="result-count">Hi·ªÉn th·ªã {{ projects|length }} projects</p>
    {% else %}
    <div class="alert alert-info">Kh√¥ng c√≥ projects n√†o ho·∫∑c VPD ƒë√£ filter h·∫øt.</div>
    {% endif %}
</div>

<div class="test-box">
    <h3>üß™ C√°ch ki·ªÉm tra VPD</h3>
    <ol>
        <li>Login v·ªõi <code>HR_USER</code> ‚Üí Ch·ªâ th·∫•y projects c√≥ DEPARTMENT = 'HR'</li>
        <li>Login v·ªõi <code>IT_USER</code> ‚Üí Ch·ªâ th·∫•y projects c√≥ DEPARTMENT = 'IT'</li>
        <li>Login v·ªõi <code>ADMIN</code> ‚Üí Th·∫•y t·∫•t c·∫£ projects</li>
    </ol>
</div>

<style>
    .info-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }

    .info-card pre {
        background: rgba(0, 0, 0, 0.2);
        padding: 1rem;
        border-radius: 4px;
        overflow-x: auto;
    }

    .info-card code {
        color: #fff;
    }

    .demo-section {
        background: var(--bg-primary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .test-box {
        background: var(--bg-secondary);
        border-left: 4px solid var(--primary);
        padding: 1.5rem;
        border-radius: 0 8px 8px 0;
    }

    .result-count {
        text-align: right;
        color: var(--text-secondary);
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }
</style>
{% endblock %}